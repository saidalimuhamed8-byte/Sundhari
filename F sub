# fsub.py
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import ContextTypes
from telegram.error import BadRequest

# Private channel setup
REQUIRED_CHANNELS = {
    "main": {
        "chat_id": -1001234567890,  # Replace with your private channel ID
        "invite_link": "https://t.me/+abcdEfGhIjkLmNoP"  # Replace with your invite link
    }
}

async def check_fsub(update: Update, context: ContextTypes.DEFAULT_TYPE) -> bool:
    user_id = update.effective_user.id
    bot = context.bot

    try:
        for _, data in REQUIRED_CHANNELS.items():
            chat_id = data["chat_id"]
            member = await bot.get_chat_member(chat_id, user_id)

            if member.status in ("left", "kicked"):
                await send_join_message(update, context)
                return False
    except BadRequest:
        await send_join_message(update, context)
        return False

    return True


async def send_join_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    buttons = []
    for _, data in REQUIRED_CHANNELS.items():
        buttons.append([InlineKeyboardButton("üì¢ Join Channel", url=data["invite_link"])])

    keyboard = InlineKeyboardMarkup(buttons)

    if update.message:
        await update.message.reply_text(
            "‚ö†Ô∏è You must join our private channel to use this bot.",
            reply_markup=keyboard
        )
    elif update.callback_query:
        await update.callback_query.message.reply_text(
            "‚ö†Ô∏è You must join our private channel to use this bot.",
            reply_markup=keyboard
        )
